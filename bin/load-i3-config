#!/bin/bash

dotfiles_dir=$1
[[ ! $dotfiles_dir ]] && dotfiles_dir=$X_DOTFILES

template_file=$dotfiles_dir/i3/config
config_file=~/.config/i3/config

warning_header=$(
cat <<HEADER
#
#------------------------------------------------------------------------------
#
# DO NOT EDIT THIS FILE.
#
#------------------------------------------------------------------------------
#
# New settings must be set in "$template_file" and loaded with
# \`$X_DOTFILES/bin/load-i3-config\` or using the keyboard shortcut \`\$mod+Shift+r\`.
#
HEADER
)

echo "$warning_header" > $config_file

echo "set \$X_DOTFILES $dotfiles_dir" >> $config_file

cat $template_file |\
  sed '/^#/d' |\
  sed '/^\s*$/d' \
  >> $config_file

i3-msg 'restart'
