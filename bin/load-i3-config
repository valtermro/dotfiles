#!/bin/bash

dotfiles_dir=$1
[[ ! $dotfiles_dir ]] && dotfiles_dir=$X_DOTFILES

template_file=$dotfiles_dir/i3/config
# config_file=~/.config/i3/config
config_file=/tmp/i3config

cat <<HEADER > $config_file
#
#==============================================================================
#
# DO NOT EDIT THIS FILE.
#
#==============================================================================
#
# New settings must be set in "$template_file" and loaded with
# \`$X_DOTFILES/bin/load-i3-config\` or using the keyboard shortcut \`\$mod+Shift+r\`.
#
HEADER

# parse the template
parsed_config=$(
cat $template_file |\
  # remove comments
  sed '/^\s*#/d' |\

  # remove empty lines
  sed '/^\s*$/d' |\

  # replace $X_DOTFILES with its value
  sed "s/\$X_DOTFILES/$(echo $dotfiles_dir | sed 's#/#\\/#g')/g"
)

# i3-msg 'restart'

echo "$parsed_config"
  #
  # # add the parsed content to the config file
  # tee > $config_file
